<ng-container *ngIf="showRegister(); else loginBlock">
	<form (submit)="submitRegister($event)" class="card auth-panel card-lg form-stack" aria-labelledby="register-heading" style="margin:40px auto; max-width:370px;">
		<h3 id="register-heading" class="auth-title" style="margin-bottom:1.2rem;">
			<i class="bi bi-person-plus" style="font-size:1rem;"></i> Registro
		</h3>
		<label class="form-label">
			<span>Usuario *</span>
			<input type="text" [disabled]="loading()" [ngModel]="username()" (ngModelChange)="username.set($event)" name="reg_username" placeholder="Usuario" required [class.invalid]="regAttempt && (!username() || !validUsername())">
			<div *ngIf="regAttempt && username() && !validUsername()" style="color:var(--color-danger); font-size:.7rem; margin-top:.5rem;">
				Solo letras y números permitidos en el usuario.
			</div>
		</label>
		<label class="form-label">
			<span>Email *</span>
			<input type="email" [disabled]="loading()" [ngModel]="email()" (ngModelChange)="email.set($event)" name="reg_email" placeholder="Email" required [class.invalid]="regAttempt && (!email() || !validEmail())">
		</label>
		<label class="form-label">
			<span>Password * (mínimo 4)</span>
			<div style="display:flex; align-items:center; gap:.5rem;">
				<input [type]="showPw() ? 'text' : 'password'" [disabled]="loading()" [ngModel]="password()" (ngModelChange)="password.set($event)" name="reg_password" required [class.invalid]="regAttempt && !password()" style="flex:1;">
				<button type="button" class="btn ghost-btn" (click)="toggleShowPw()" [disabled]="loading()" [attr.aria-label]="showPw() ? 'Ocultar password' : 'Mostrar password'">
					<i class="bi" [class.bi-eye]="!showPw()" [class.bi-eye-slash]="showPw()"></i>
				</button>
			</div>
			<div *ngIf="password()" style="margin-top:.25rem;">
				<div style="display:flex; align-items:center; gap:.6rem;">
					<div style="flex:1; display:flex; gap:.3rem;">
						<span *ngFor="let _ of [0,1,2,3,4]; let i=index" [style]="'flex:1; height:6px; border-radius:2px; background:' + (i < pwStrength() ? strengthColors[pwStrength()] : 'var(--color-border)')"></span>
					</div>
					<span [style]="'font-size:.55rem; font-weight:600; letter-spacing:.5px; color:' + strengthColors[pwStrength()]">{{ strengthLabels[pwStrength()] }}</span>
				</div>
			</div>
		</label>
			<div class="inline" style="gap:.5rem; margin-top:.5rem;">
				<button type="button" class="btn ghost-btn" (click)="showLoginForm()" [disabled]="loading()">Volver</button>
			<button type="submit" class="btn btn-primary" [disabled]="loading() || !validEmail()">
					{{ loading() ? 'Registrando...' : 'Registrar' }}
				</button>
			</div>
			<div *ngIf="regAttempt && (!username() || !email() || !password())" style="color:var(--color-danger); font-size:.7rem; margin-top:.5rem;">
				Todos los campos son obligatorios.
			</div>
					<div *ngIf="regAttempt && email() && !validEmail()" style="color:var(--color-danger); font-size:.7rem; margin-top:.5rem;">
						Ingresa un email válido.
					</div>
			<p *ngIf="regMsg" role="alert" [style.color]="regMsg.includes('registrado') ? 'var(--color-success)' : 'var(--color-danger)'" style="font-size:.7rem; margin:0; margin-top:.5rem;">{{ regMsg }}</p>
	</form>
</ng-container>
<ng-template #loginBlock>
	<form (submit)="submitLogin($event)" class="card auth-panel card-lg form-stack" aria-labelledby="login-heading" style="margin:40px auto; max-width:370px;">
		<h3 id="login-heading" class="auth-title" style="margin-bottom:1.2rem;">
			<i class="bi bi-box-arrow-in-right" style="font-size:1rem;"></i> Login
		</h3>
		<label class="form-label">
			<span>Usuario *</span>
			<input type="text" [disabled]="loading()" [ngModel]="loginUser" (ngModelChange)="loginUser = $event" name="login_username" placeholder="Usuario" required [class.invalid]="loginAttempt && !loginUser">
		</label>
		<label class="form-label">
			<span>Password *</span>
			<div style="display:flex; align-items:center; gap:.5rem;">
				<input [type]="showPwLogin ? 'text' : 'password'" [disabled]="loading()" [ngModel]="loginPass" (ngModelChange)="loginPass = $event" name="login_password" required [class.invalid]="loginAttempt && !loginPass" style="flex:1;">
				<button type="button" class="btn ghost-btn" (click)="toggleShowPwLogin()" [disabled]="loading()" [attr.aria-label]="showPwLogin ? 'Ocultar password' : 'Mostrar password'">
					<i class="bi" [class.bi-eye]="!showPwLogin" [class.bi-eye-slash]="showPwLogin"></i>
				</button>
			</div>
		</label>
		<div class="inline" style="gap:.5rem; margin-top:1.2rem;">
			<button type="submit" class="btn btn-primary" [disabled]="loading()">
				{{ loading() ? 'Entrando...' : 'Entrar' }}
			</button>
		</div>
		<div *ngIf="loginAttempt && (!loginUser || !loginPass)" style="color:var(--color-danger); font-size:.7rem; margin-top:.5rem;">
			Usuario y password requeridos.
		</div>
		<p *ngIf="loginMsg" role="alert" [style.color]="'var(--color-danger)'" style="font-size:.7rem; margin:0; margin-top:.5rem;">{{ loginMsg }}</p>
		<div style="margin-top:1.2rem; text-align:center;">
			<button type="button" class="btn ghost-btn" (click)="showRegisterForm()" [disabled]="loading()">Crear cuenta</button>
		</div>
	</form>
</ng-template>
